package tech.kronicle.plugins.aws.xray.services;

import lombok.RequiredArgsConstructor;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import tech.kronicle.plugins.aws.config.AwsProfileConfig;
import tech.kronicle.plugins.aws.models.AwsProfileAndRegion;
import tech.kronicle.plugins.aws.xray.client.XRayClientFacade;
import tech.kronicle.plugins.aws.xray.client.XRayClientFacadeFactory;
import tech.kronicle.plugins.aws.xray.models.XRayDependency;
import tech.kronicle.plugins.aws.xray.models.XRayServiceGraphPage;

import java.time.Clock;
import java.time.Instant;
import java.time.LocalDateTime;
import java.time.ZoneOffset;
import java.util.List;

import static java.util.Objects.isNull;
import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.when;

@ExtendWith(MockitoExtension.class)
public class XRayServiceGraphFetcherTest {

    @Mock
    private XRayClientFacadeFactory clientFacadeFactory;
    private final Clock clock = Clock.fixed(
            LocalDateTime.of(2000, 2, 1, 0, 0, 0).toInstant(ZoneOffset.UTC),
            ZoneOffset.UTC
    );

    @Test
    public void getServiceGraphShouldRetrieveDataForLast30DaysMinus6Hours() {
        // Given
        XRayServiceGraphFetcher underTest = createUnderTest();
        AwsProfileAndRegion profileAndRegion = new AwsProfileAndRegion(
                new AwsProfileConfig(
                        "test-access-key-id",
                        "test-secret-access-key",
                        null,
                        null,
                        null,
                        null),
                "test-region"
        );
        FakeXRayClientFacade clientFacade = new FakeXRayClientFacade(2);
        when(clientFacadeFactory.createXRayClientFacade(profileAndRegion)).thenReturn(clientFacade);

        // When
        List<XRayDependency> returnValue = underTest.getServiceGraph(profileAndRegion);

        // Then
        assertThat(returnValue).containsExactly(
                creatXRayDependency("2000-01-02T06:00:00Z-null-1", "2000-01-02T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-02T06:00:00Z-null-2", "2000-01-02T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-02T06:00:00Z-2-1", "2000-01-02T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-02T06:00:00Z-2-2", "2000-01-02T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-02T12:00:00Z-null-1", "2000-01-02T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-02T12:00:00Z-null-2", "2000-01-02T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-02T12:00:00Z-2-1", "2000-01-02T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-02T12:00:00Z-2-2", "2000-01-02T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-02T18:00:00Z-null-1", "2000-01-03T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-02T18:00:00Z-null-2", "2000-01-03T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-02T18:00:00Z-2-1", "2000-01-03T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-02T18:00:00Z-2-2", "2000-01-03T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-03T00:00:00Z-null-1", "2000-01-03T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-03T00:00:00Z-null-2", "2000-01-03T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-03T00:00:00Z-2-1", "2000-01-03T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-03T00:00:00Z-2-2", "2000-01-03T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-03T06:00:00Z-null-1", "2000-01-03T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-03T06:00:00Z-null-2", "2000-01-03T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-03T06:00:00Z-2-1", "2000-01-03T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-03T06:00:00Z-2-2", "2000-01-03T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-03T12:00:00Z-null-1", "2000-01-03T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-03T12:00:00Z-null-2", "2000-01-03T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-03T12:00:00Z-2-1", "2000-01-03T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-03T12:00:00Z-2-2", "2000-01-03T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-03T18:00:00Z-null-1", "2000-01-04T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-03T18:00:00Z-null-2", "2000-01-04T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-03T18:00:00Z-2-1", "2000-01-04T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-03T18:00:00Z-2-2", "2000-01-04T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-04T00:00:00Z-null-1", "2000-01-04T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-04T00:00:00Z-null-2", "2000-01-04T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-04T00:00:00Z-2-1", "2000-01-04T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-04T00:00:00Z-2-2", "2000-01-04T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-04T06:00:00Z-null-1", "2000-01-04T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-04T06:00:00Z-null-2", "2000-01-04T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-04T06:00:00Z-2-1", "2000-01-04T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-04T06:00:00Z-2-2", "2000-01-04T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-04T12:00:00Z-null-1", "2000-01-04T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-04T12:00:00Z-null-2", "2000-01-04T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-04T12:00:00Z-2-1", "2000-01-04T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-04T12:00:00Z-2-2", "2000-01-04T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-04T18:00:00Z-null-1", "2000-01-05T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-04T18:00:00Z-null-2", "2000-01-05T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-04T18:00:00Z-2-1", "2000-01-05T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-04T18:00:00Z-2-2", "2000-01-05T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-05T00:00:00Z-null-1", "2000-01-05T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-05T00:00:00Z-null-2", "2000-01-05T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-05T00:00:00Z-2-1", "2000-01-05T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-05T00:00:00Z-2-2", "2000-01-05T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-05T06:00:00Z-null-1", "2000-01-05T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-05T06:00:00Z-null-2", "2000-01-05T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-05T06:00:00Z-2-1", "2000-01-05T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-05T06:00:00Z-2-2", "2000-01-05T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-05T12:00:00Z-null-1", "2000-01-05T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-05T12:00:00Z-null-2", "2000-01-05T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-05T12:00:00Z-2-1", "2000-01-05T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-05T12:00:00Z-2-2", "2000-01-05T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-05T18:00:00Z-null-1", "2000-01-06T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-05T18:00:00Z-null-2", "2000-01-06T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-05T18:00:00Z-2-1", "2000-01-06T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-05T18:00:00Z-2-2", "2000-01-06T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-06T00:00:00Z-null-1", "2000-01-06T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-06T00:00:00Z-null-2", "2000-01-06T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-06T00:00:00Z-2-1", "2000-01-06T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-06T00:00:00Z-2-2", "2000-01-06T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-06T06:00:00Z-null-1", "2000-01-06T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-06T06:00:00Z-null-2", "2000-01-06T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-06T06:00:00Z-2-1", "2000-01-06T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-06T06:00:00Z-2-2", "2000-01-06T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-06T12:00:00Z-null-1", "2000-01-06T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-06T12:00:00Z-null-2", "2000-01-06T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-06T12:00:00Z-2-1", "2000-01-06T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-06T12:00:00Z-2-2", "2000-01-06T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-06T18:00:00Z-null-1", "2000-01-07T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-06T18:00:00Z-null-2", "2000-01-07T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-06T18:00:00Z-2-1", "2000-01-07T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-06T18:00:00Z-2-2", "2000-01-07T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-07T00:00:00Z-null-1", "2000-01-07T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-07T00:00:00Z-null-2", "2000-01-07T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-07T00:00:00Z-2-1", "2000-01-07T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-07T00:00:00Z-2-2", "2000-01-07T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-07T06:00:00Z-null-1", "2000-01-07T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-07T06:00:00Z-null-2", "2000-01-07T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-07T06:00:00Z-2-1", "2000-01-07T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-07T06:00:00Z-2-2", "2000-01-07T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-07T12:00:00Z-null-1", "2000-01-07T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-07T12:00:00Z-null-2", "2000-01-07T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-07T12:00:00Z-2-1", "2000-01-07T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-07T12:00:00Z-2-2", "2000-01-07T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-07T18:00:00Z-null-1", "2000-01-08T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-07T18:00:00Z-null-2", "2000-01-08T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-07T18:00:00Z-2-1", "2000-01-08T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-07T18:00:00Z-2-2", "2000-01-08T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-08T00:00:00Z-null-1", "2000-01-08T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-08T00:00:00Z-null-2", "2000-01-08T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-08T00:00:00Z-2-1", "2000-01-08T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-08T00:00:00Z-2-2", "2000-01-08T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-08T06:00:00Z-null-1", "2000-01-08T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-08T06:00:00Z-null-2", "2000-01-08T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-08T06:00:00Z-2-1", "2000-01-08T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-08T06:00:00Z-2-2", "2000-01-08T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-08T12:00:00Z-null-1", "2000-01-08T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-08T12:00:00Z-null-2", "2000-01-08T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-08T12:00:00Z-2-1", "2000-01-08T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-08T12:00:00Z-2-2", "2000-01-08T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-08T18:00:00Z-null-1", "2000-01-09T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-08T18:00:00Z-null-2", "2000-01-09T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-08T18:00:00Z-2-1", "2000-01-09T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-08T18:00:00Z-2-2", "2000-01-09T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-09T00:00:00Z-null-1", "2000-01-09T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-09T00:00:00Z-null-2", "2000-01-09T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-09T00:00:00Z-2-1", "2000-01-09T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-09T00:00:00Z-2-2", "2000-01-09T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-09T06:00:00Z-null-1", "2000-01-09T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-09T06:00:00Z-null-2", "2000-01-09T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-09T06:00:00Z-2-1", "2000-01-09T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-09T06:00:00Z-2-2", "2000-01-09T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-09T12:00:00Z-null-1", "2000-01-09T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-09T12:00:00Z-null-2", "2000-01-09T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-09T12:00:00Z-2-1", "2000-01-09T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-09T12:00:00Z-2-2", "2000-01-09T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-09T18:00:00Z-null-1", "2000-01-10T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-09T18:00:00Z-null-2", "2000-01-10T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-09T18:00:00Z-2-1", "2000-01-10T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-09T18:00:00Z-2-2", "2000-01-10T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-10T00:00:00Z-null-1", "2000-01-10T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-10T00:00:00Z-null-2", "2000-01-10T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-10T00:00:00Z-2-1", "2000-01-10T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-10T00:00:00Z-2-2", "2000-01-10T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-10T06:00:00Z-null-1", "2000-01-10T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-10T06:00:00Z-null-2", "2000-01-10T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-10T06:00:00Z-2-1", "2000-01-10T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-10T06:00:00Z-2-2", "2000-01-10T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-10T12:00:00Z-null-1", "2000-01-10T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-10T12:00:00Z-null-2", "2000-01-10T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-10T12:00:00Z-2-1", "2000-01-10T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-10T12:00:00Z-2-2", "2000-01-10T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-10T18:00:00Z-null-1", "2000-01-11T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-10T18:00:00Z-null-2", "2000-01-11T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-10T18:00:00Z-2-1", "2000-01-11T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-10T18:00:00Z-2-2", "2000-01-11T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-11T00:00:00Z-null-1", "2000-01-11T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-11T00:00:00Z-null-2", "2000-01-11T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-11T00:00:00Z-2-1", "2000-01-11T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-11T00:00:00Z-2-2", "2000-01-11T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-11T06:00:00Z-null-1", "2000-01-11T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-11T06:00:00Z-null-2", "2000-01-11T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-11T06:00:00Z-2-1", "2000-01-11T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-11T06:00:00Z-2-2", "2000-01-11T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-11T12:00:00Z-null-1", "2000-01-11T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-11T12:00:00Z-null-2", "2000-01-11T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-11T12:00:00Z-2-1", "2000-01-11T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-11T12:00:00Z-2-2", "2000-01-11T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-11T18:00:00Z-null-1", "2000-01-12T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-11T18:00:00Z-null-2", "2000-01-12T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-11T18:00:00Z-2-1", "2000-01-12T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-11T18:00:00Z-2-2", "2000-01-12T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-12T00:00:00Z-null-1", "2000-01-12T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-12T00:00:00Z-null-2", "2000-01-12T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-12T00:00:00Z-2-1", "2000-01-12T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-12T00:00:00Z-2-2", "2000-01-12T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-12T06:00:00Z-null-1", "2000-01-12T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-12T06:00:00Z-null-2", "2000-01-12T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-12T06:00:00Z-2-1", "2000-01-12T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-12T06:00:00Z-2-2", "2000-01-12T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-12T12:00:00Z-null-1", "2000-01-12T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-12T12:00:00Z-null-2", "2000-01-12T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-12T12:00:00Z-2-1", "2000-01-12T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-12T12:00:00Z-2-2", "2000-01-12T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-12T18:00:00Z-null-1", "2000-01-13T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-12T18:00:00Z-null-2", "2000-01-13T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-12T18:00:00Z-2-1", "2000-01-13T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-12T18:00:00Z-2-2", "2000-01-13T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-13T00:00:00Z-null-1", "2000-01-13T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-13T00:00:00Z-null-2", "2000-01-13T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-13T00:00:00Z-2-1", "2000-01-13T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-13T00:00:00Z-2-2", "2000-01-13T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-13T06:00:00Z-null-1", "2000-01-13T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-13T06:00:00Z-null-2", "2000-01-13T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-13T06:00:00Z-2-1", "2000-01-13T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-13T06:00:00Z-2-2", "2000-01-13T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-13T12:00:00Z-null-1", "2000-01-13T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-13T12:00:00Z-null-2", "2000-01-13T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-13T12:00:00Z-2-1", "2000-01-13T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-13T12:00:00Z-2-2", "2000-01-13T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-13T18:00:00Z-null-1", "2000-01-14T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-13T18:00:00Z-null-2", "2000-01-14T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-13T18:00:00Z-2-1", "2000-01-14T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-13T18:00:00Z-2-2", "2000-01-14T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-14T00:00:00Z-null-1", "2000-01-14T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-14T00:00:00Z-null-2", "2000-01-14T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-14T00:00:00Z-2-1", "2000-01-14T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-14T00:00:00Z-2-2", "2000-01-14T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-14T06:00:00Z-null-1", "2000-01-14T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-14T06:00:00Z-null-2", "2000-01-14T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-14T06:00:00Z-2-1", "2000-01-14T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-14T06:00:00Z-2-2", "2000-01-14T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-14T12:00:00Z-null-1", "2000-01-14T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-14T12:00:00Z-null-2", "2000-01-14T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-14T12:00:00Z-2-1", "2000-01-14T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-14T12:00:00Z-2-2", "2000-01-14T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-14T18:00:00Z-null-1", "2000-01-15T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-14T18:00:00Z-null-2", "2000-01-15T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-14T18:00:00Z-2-1", "2000-01-15T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-14T18:00:00Z-2-2", "2000-01-15T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-15T00:00:00Z-null-1", "2000-01-15T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-15T00:00:00Z-null-2", "2000-01-15T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-15T00:00:00Z-2-1", "2000-01-15T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-15T00:00:00Z-2-2", "2000-01-15T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-15T06:00:00Z-null-1", "2000-01-15T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-15T06:00:00Z-null-2", "2000-01-15T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-15T06:00:00Z-2-1", "2000-01-15T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-15T06:00:00Z-2-2", "2000-01-15T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-15T12:00:00Z-null-1", "2000-01-15T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-15T12:00:00Z-null-2", "2000-01-15T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-15T12:00:00Z-2-1", "2000-01-15T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-15T12:00:00Z-2-2", "2000-01-15T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-15T18:00:00Z-null-1", "2000-01-16T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-15T18:00:00Z-null-2", "2000-01-16T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-15T18:00:00Z-2-1", "2000-01-16T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-15T18:00:00Z-2-2", "2000-01-16T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-16T00:00:00Z-null-1", "2000-01-16T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-16T00:00:00Z-null-2", "2000-01-16T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-16T00:00:00Z-2-1", "2000-01-16T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-16T00:00:00Z-2-2", "2000-01-16T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-16T06:00:00Z-null-1", "2000-01-16T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-16T06:00:00Z-null-2", "2000-01-16T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-16T06:00:00Z-2-1", "2000-01-16T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-16T06:00:00Z-2-2", "2000-01-16T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-16T12:00:00Z-null-1", "2000-01-16T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-16T12:00:00Z-null-2", "2000-01-16T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-16T12:00:00Z-2-1", "2000-01-16T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-16T12:00:00Z-2-2", "2000-01-16T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-16T18:00:00Z-null-1", "2000-01-17T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-16T18:00:00Z-null-2", "2000-01-17T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-16T18:00:00Z-2-1", "2000-01-17T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-16T18:00:00Z-2-2", "2000-01-17T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-17T00:00:00Z-null-1", "2000-01-17T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-17T00:00:00Z-null-2", "2000-01-17T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-17T00:00:00Z-2-1", "2000-01-17T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-17T00:00:00Z-2-2", "2000-01-17T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-17T06:00:00Z-null-1", "2000-01-17T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-17T06:00:00Z-null-2", "2000-01-17T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-17T06:00:00Z-2-1", "2000-01-17T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-17T06:00:00Z-2-2", "2000-01-17T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-17T12:00:00Z-null-1", "2000-01-17T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-17T12:00:00Z-null-2", "2000-01-17T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-17T12:00:00Z-2-1", "2000-01-17T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-17T12:00:00Z-2-2", "2000-01-17T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-17T18:00:00Z-null-1", "2000-01-18T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-17T18:00:00Z-null-2", "2000-01-18T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-17T18:00:00Z-2-1", "2000-01-18T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-17T18:00:00Z-2-2", "2000-01-18T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-18T00:00:00Z-null-1", "2000-01-18T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-18T00:00:00Z-null-2", "2000-01-18T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-18T00:00:00Z-2-1", "2000-01-18T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-18T00:00:00Z-2-2", "2000-01-18T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-18T06:00:00Z-null-1", "2000-01-18T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-18T06:00:00Z-null-2", "2000-01-18T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-18T06:00:00Z-2-1", "2000-01-18T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-18T06:00:00Z-2-2", "2000-01-18T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-18T12:00:00Z-null-1", "2000-01-18T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-18T12:00:00Z-null-2", "2000-01-18T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-18T12:00:00Z-2-1", "2000-01-18T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-18T12:00:00Z-2-2", "2000-01-18T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-18T18:00:00Z-null-1", "2000-01-19T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-18T18:00:00Z-null-2", "2000-01-19T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-18T18:00:00Z-2-1", "2000-01-19T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-18T18:00:00Z-2-2", "2000-01-19T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-19T00:00:00Z-null-1", "2000-01-19T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-19T00:00:00Z-null-2", "2000-01-19T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-19T00:00:00Z-2-1", "2000-01-19T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-19T00:00:00Z-2-2", "2000-01-19T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-19T06:00:00Z-null-1", "2000-01-19T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-19T06:00:00Z-null-2", "2000-01-19T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-19T06:00:00Z-2-1", "2000-01-19T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-19T06:00:00Z-2-2", "2000-01-19T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-19T12:00:00Z-null-1", "2000-01-19T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-19T12:00:00Z-null-2", "2000-01-19T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-19T12:00:00Z-2-1", "2000-01-19T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-19T12:00:00Z-2-2", "2000-01-19T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-19T18:00:00Z-null-1", "2000-01-20T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-19T18:00:00Z-null-2", "2000-01-20T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-19T18:00:00Z-2-1", "2000-01-20T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-19T18:00:00Z-2-2", "2000-01-20T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-20T00:00:00Z-null-1", "2000-01-20T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-20T00:00:00Z-null-2", "2000-01-20T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-20T00:00:00Z-2-1", "2000-01-20T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-20T00:00:00Z-2-2", "2000-01-20T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-20T06:00:00Z-null-1", "2000-01-20T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-20T06:00:00Z-null-2", "2000-01-20T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-20T06:00:00Z-2-1", "2000-01-20T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-20T06:00:00Z-2-2", "2000-01-20T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-20T12:00:00Z-null-1", "2000-01-20T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-20T12:00:00Z-null-2", "2000-01-20T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-20T12:00:00Z-2-1", "2000-01-20T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-20T12:00:00Z-2-2", "2000-01-20T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-20T18:00:00Z-null-1", "2000-01-21T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-20T18:00:00Z-null-2", "2000-01-21T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-20T18:00:00Z-2-1", "2000-01-21T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-20T18:00:00Z-2-2", "2000-01-21T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-21T00:00:00Z-null-1", "2000-01-21T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-21T00:00:00Z-null-2", "2000-01-21T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-21T00:00:00Z-2-1", "2000-01-21T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-21T00:00:00Z-2-2", "2000-01-21T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-21T06:00:00Z-null-1", "2000-01-21T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-21T06:00:00Z-null-2", "2000-01-21T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-21T06:00:00Z-2-1", "2000-01-21T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-21T06:00:00Z-2-2", "2000-01-21T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-21T12:00:00Z-null-1", "2000-01-21T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-21T12:00:00Z-null-2", "2000-01-21T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-21T12:00:00Z-2-1", "2000-01-21T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-21T12:00:00Z-2-2", "2000-01-21T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-21T18:00:00Z-null-1", "2000-01-22T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-21T18:00:00Z-null-2", "2000-01-22T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-21T18:00:00Z-2-1", "2000-01-22T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-21T18:00:00Z-2-2", "2000-01-22T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-22T00:00:00Z-null-1", "2000-01-22T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-22T00:00:00Z-null-2", "2000-01-22T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-22T00:00:00Z-2-1", "2000-01-22T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-22T00:00:00Z-2-2", "2000-01-22T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-22T06:00:00Z-null-1", "2000-01-22T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-22T06:00:00Z-null-2", "2000-01-22T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-22T06:00:00Z-2-1", "2000-01-22T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-22T06:00:00Z-2-2", "2000-01-22T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-22T12:00:00Z-null-1", "2000-01-22T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-22T12:00:00Z-null-2", "2000-01-22T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-22T12:00:00Z-2-1", "2000-01-22T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-22T12:00:00Z-2-2", "2000-01-22T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-22T18:00:00Z-null-1", "2000-01-23T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-22T18:00:00Z-null-2", "2000-01-23T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-22T18:00:00Z-2-1", "2000-01-23T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-22T18:00:00Z-2-2", "2000-01-23T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-23T00:00:00Z-null-1", "2000-01-23T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-23T00:00:00Z-null-2", "2000-01-23T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-23T00:00:00Z-2-1", "2000-01-23T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-23T00:00:00Z-2-2", "2000-01-23T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-23T06:00:00Z-null-1", "2000-01-23T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-23T06:00:00Z-null-2", "2000-01-23T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-23T06:00:00Z-2-1", "2000-01-23T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-23T06:00:00Z-2-2", "2000-01-23T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-23T12:00:00Z-null-1", "2000-01-23T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-23T12:00:00Z-null-2", "2000-01-23T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-23T12:00:00Z-2-1", "2000-01-23T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-23T12:00:00Z-2-2", "2000-01-23T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-23T18:00:00Z-null-1", "2000-01-24T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-23T18:00:00Z-null-2", "2000-01-24T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-23T18:00:00Z-2-1", "2000-01-24T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-23T18:00:00Z-2-2", "2000-01-24T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-24T00:00:00Z-null-1", "2000-01-24T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-24T00:00:00Z-null-2", "2000-01-24T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-24T00:00:00Z-2-1", "2000-01-24T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-24T00:00:00Z-2-2", "2000-01-24T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-24T06:00:00Z-null-1", "2000-01-24T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-24T06:00:00Z-null-2", "2000-01-24T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-24T06:00:00Z-2-1", "2000-01-24T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-24T06:00:00Z-2-2", "2000-01-24T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-24T12:00:00Z-null-1", "2000-01-24T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-24T12:00:00Z-null-2", "2000-01-24T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-24T12:00:00Z-2-1", "2000-01-24T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-24T12:00:00Z-2-2", "2000-01-24T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-24T18:00:00Z-null-1", "2000-01-25T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-24T18:00:00Z-null-2", "2000-01-25T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-24T18:00:00Z-2-1", "2000-01-25T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-24T18:00:00Z-2-2", "2000-01-25T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-25T00:00:00Z-null-1", "2000-01-25T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-25T00:00:00Z-null-2", "2000-01-25T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-25T00:00:00Z-2-1", "2000-01-25T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-25T00:00:00Z-2-2", "2000-01-25T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-25T06:00:00Z-null-1", "2000-01-25T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-25T06:00:00Z-null-2", "2000-01-25T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-25T06:00:00Z-2-1", "2000-01-25T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-25T06:00:00Z-2-2", "2000-01-25T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-25T12:00:00Z-null-1", "2000-01-25T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-25T12:00:00Z-null-2", "2000-01-25T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-25T12:00:00Z-2-1", "2000-01-25T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-25T12:00:00Z-2-2", "2000-01-25T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-25T18:00:00Z-null-1", "2000-01-26T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-25T18:00:00Z-null-2", "2000-01-26T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-25T18:00:00Z-2-1", "2000-01-26T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-25T18:00:00Z-2-2", "2000-01-26T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-26T00:00:00Z-null-1", "2000-01-26T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-26T00:00:00Z-null-2", "2000-01-26T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-26T00:00:00Z-2-1", "2000-01-26T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-26T00:00:00Z-2-2", "2000-01-26T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-26T06:00:00Z-null-1", "2000-01-26T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-26T06:00:00Z-null-2", "2000-01-26T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-26T06:00:00Z-2-1", "2000-01-26T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-26T06:00:00Z-2-2", "2000-01-26T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-26T12:00:00Z-null-1", "2000-01-26T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-26T12:00:00Z-null-2", "2000-01-26T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-26T12:00:00Z-2-1", "2000-01-26T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-26T12:00:00Z-2-2", "2000-01-26T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-26T18:00:00Z-null-1", "2000-01-27T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-26T18:00:00Z-null-2", "2000-01-27T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-26T18:00:00Z-2-1", "2000-01-27T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-26T18:00:00Z-2-2", "2000-01-27T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-27T00:00:00Z-null-1", "2000-01-27T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-27T00:00:00Z-null-2", "2000-01-27T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-27T00:00:00Z-2-1", "2000-01-27T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-27T00:00:00Z-2-2", "2000-01-27T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-27T06:00:00Z-null-1", "2000-01-27T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-27T06:00:00Z-null-2", "2000-01-27T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-27T06:00:00Z-2-1", "2000-01-27T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-27T06:00:00Z-2-2", "2000-01-27T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-27T12:00:00Z-null-1", "2000-01-27T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-27T12:00:00Z-null-2", "2000-01-27T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-27T12:00:00Z-2-1", "2000-01-27T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-27T12:00:00Z-2-2", "2000-01-27T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-27T18:00:00Z-null-1", "2000-01-28T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-27T18:00:00Z-null-2", "2000-01-28T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-27T18:00:00Z-2-1", "2000-01-28T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-27T18:00:00Z-2-2", "2000-01-28T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-28T00:00:00Z-null-1", "2000-01-28T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-28T00:00:00Z-null-2", "2000-01-28T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-28T00:00:00Z-2-1", "2000-01-28T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-28T00:00:00Z-2-2", "2000-01-28T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-28T06:00:00Z-null-1", "2000-01-28T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-28T06:00:00Z-null-2", "2000-01-28T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-28T06:00:00Z-2-1", "2000-01-28T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-28T06:00:00Z-2-2", "2000-01-28T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-28T12:00:00Z-null-1", "2000-01-28T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-28T12:00:00Z-null-2", "2000-01-28T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-28T12:00:00Z-2-1", "2000-01-28T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-28T12:00:00Z-2-2", "2000-01-28T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-28T18:00:00Z-null-1", "2000-01-29T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-28T18:00:00Z-null-2", "2000-01-29T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-28T18:00:00Z-2-1", "2000-01-29T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-28T18:00:00Z-2-2", "2000-01-29T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-29T00:00:00Z-null-1", "2000-01-29T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-29T00:00:00Z-null-2", "2000-01-29T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-29T00:00:00Z-2-1", "2000-01-29T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-29T00:00:00Z-2-2", "2000-01-29T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-29T06:00:00Z-null-1", "2000-01-29T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-29T06:00:00Z-null-2", "2000-01-29T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-29T06:00:00Z-2-1", "2000-01-29T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-29T06:00:00Z-2-2", "2000-01-29T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-29T12:00:00Z-null-1", "2000-01-29T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-29T12:00:00Z-null-2", "2000-01-29T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-29T12:00:00Z-2-1", "2000-01-29T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-29T12:00:00Z-2-2", "2000-01-29T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-29T18:00:00Z-null-1", "2000-01-30T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-29T18:00:00Z-null-2", "2000-01-30T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-29T18:00:00Z-2-1", "2000-01-30T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-29T18:00:00Z-2-2", "2000-01-30T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-30T00:00:00Z-null-1", "2000-01-30T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-30T00:00:00Z-null-2", "2000-01-30T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-30T00:00:00Z-2-1", "2000-01-30T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-30T00:00:00Z-2-2", "2000-01-30T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-30T06:00:00Z-null-1", "2000-01-30T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-30T06:00:00Z-null-2", "2000-01-30T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-30T06:00:00Z-2-1", "2000-01-30T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-30T06:00:00Z-2-2", "2000-01-30T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-30T12:00:00Z-null-1", "2000-01-30T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-30T12:00:00Z-null-2", "2000-01-30T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-30T12:00:00Z-2-1", "2000-01-30T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-30T12:00:00Z-2-2", "2000-01-30T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-30T18:00:00Z-null-1", "2000-01-31T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-30T18:00:00Z-null-2", "2000-01-31T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-30T18:00:00Z-2-1", "2000-01-31T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-30T18:00:00Z-2-2", "2000-01-31T00:00:00Z-2-2"),
                creatXRayDependency("2000-01-31T00:00:00Z-null-1", "2000-01-31T06:00:00Z-null-1"),
                creatXRayDependency("2000-01-31T00:00:00Z-null-2", "2000-01-31T06:00:00Z-null-2"),
                creatXRayDependency("2000-01-31T00:00:00Z-2-1", "2000-01-31T06:00:00Z-2-1"),
                creatXRayDependency("2000-01-31T00:00:00Z-2-2", "2000-01-31T06:00:00Z-2-2"),
                creatXRayDependency("2000-01-31T06:00:00Z-null-1", "2000-01-31T12:00:00Z-null-1"),
                creatXRayDependency("2000-01-31T06:00:00Z-null-2", "2000-01-31T12:00:00Z-null-2"),
                creatXRayDependency("2000-01-31T06:00:00Z-2-1", "2000-01-31T12:00:00Z-2-1"),
                creatXRayDependency("2000-01-31T06:00:00Z-2-2", "2000-01-31T12:00:00Z-2-2"),
                creatXRayDependency("2000-01-31T12:00:00Z-null-1", "2000-01-31T18:00:00Z-null-1"),
                creatXRayDependency("2000-01-31T12:00:00Z-null-2", "2000-01-31T18:00:00Z-null-2"),
                creatXRayDependency("2000-01-31T12:00:00Z-2-1", "2000-01-31T18:00:00Z-2-1"),
                creatXRayDependency("2000-01-31T12:00:00Z-2-2", "2000-01-31T18:00:00Z-2-2"),
                creatXRayDependency("2000-01-31T18:00:00Z-null-1", "2000-02-01T00:00:00Z-null-1"),
                creatXRayDependency("2000-01-31T18:00:00Z-null-2", "2000-02-01T00:00:00Z-null-2"),
                creatXRayDependency("2000-01-31T18:00:00Z-2-1", "2000-02-01T00:00:00Z-2-1"),
                creatXRayDependency("2000-01-31T18:00:00Z-2-2", "2000-02-01T00:00:00Z-2-2")
        );
        assertThat(clientFacade.isClosed).isTrue();
    }

    private XRayDependency creatXRayDependency(String sourceServiceName, String targetServiceName) {
        return new XRayDependency(List.of(sourceServiceName), List.of(targetServiceName));
    }

    private XRayServiceGraphFetcher createUnderTest() {
        return new XRayServiceGraphFetcher(clientFacadeFactory, clock);
    }

    @RequiredArgsConstructor
    private static class FakeXRayClientFacade implements XRayClientFacade {

        private final int pageCount;
        private boolean isClosed;

        @Override
        public XRayServiceGraphPage getServiceGraph(Instant startTime, Instant endTime, String nextToken) {
            return new XRayServiceGraphPage(
                    List.of(
                            createXRayDependency(startTime, endTime, nextToken, 1),
                            createXRayDependency(startTime, endTime, nextToken, 2)
                    ),
                    getNextPage(nextToken)
            );
        }

        private XRayDependency createXRayDependency(Instant startTime, Instant endTime, String nextToken, int xRayDependencyNumber) {
            String suffix = "-" + nextToken + "-" + xRayDependencyNumber;
            return new XRayDependency(
                    List.of(startTime.toString() + suffix),
                    List.of(endTime.toString() + suffix)
            );
        }

        private String getNextPage(String nextToken) {
            int pageNumber = isNull(nextToken) ? 1 : Integer.parseInt(nextToken);
            int nextPageNumber = pageNumber + 1;

            if (nextPageNumber > pageCount) {
                return null;
            }

            return Integer.toString(nextPageNumber);
        }

        @Override
        public void close() {
            isClosed = true;
        }
    }
}
