plugins {
    id "base"
    id "tech.kronicle.dependencies-file"
    id "com.jfrog.artifactory" apply false
    id "org.sonarqube"
    id "jacoco"
    id "com.github.spotbugs"
    id "pl.allegro.tech.build.axion-release"
    id "io.snyk.gradle.plugin.snykplugin"
}

apply from: "gradle/kronicle-metadata.gradle"
apply from: "gradle/sonarqube.gradle"
apply from: "gradle/snyk.gradle"

subprojects {
    buildscript {
        apply from: "$rootDir/gradle/repos.gradle", to: buildscript
    }

    apply plugin: "java"
    apply plugin: "tech.kronicle.dependencies-file"
    apply from: "$rootDir/gradle/repos.gradle"
    apply from: "$rootDir/gradle/jacoco.gradle"
    apply from: "$rootDir/gradle/sonarqube.gradle"

    version = System.getenv("CI") != null ? scmVersion.version : "0.0.1"

    compileJava {
        options.release = javaMajorVersion.toInteger()
    }

    java {
        sourceCompatibility = JavaVersion.toVersion(javaVersion)
        targetCompatibility = JavaVersion.toVersion(javaVersion)
    }

    [compileJava, compileTestJava]*.options*.encoding = "UTF-8"
}
